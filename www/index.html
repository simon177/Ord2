<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline';img-src *; style-src * 'self' 'unsafe-inline'; media-src *" />
    <script src="cordova.js"></script>
    <link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css" />
    <script src="js/jquery-2.1.4.min.js"></script>
    <script src="js/jquery.mobile-1.4.5.min.js"></script>
    <script src="js/pgb.js"></script>
</head>

<body onload="init()">
    <div data-role="page" id="pageone">
        <div data-role="header">
            <h1>Positioning Icons</h1>
        </div>
        <form method="post" action="/action_page_post.php">
            <p>Fill in all fields on the form:</p>
            <label for="fto">League</label>
            <input type="text" name="fto" id="fto" data-clear-btn="true">
            <label for="fdate">Date: </label>
            <input type="date-time" name="fdate" id="fdate" data-clear-btn="true">
            <a href="#interesetpage" class="ui-btn ui-btn-inline ui-corner-all ui-shadow" id="inter">Interests</a>
        </form>
        <div data-role="footer">
            <h1>Footer Text</h1>
        </div>
    </div>
    <div data-role="page" id="interesetpage">
        <div data-role="header">
            <a href="#pageone" data-icon="back" style="height: 40%;"></a>
            <h1>Business Card</h1>
        </div>
        <div data-role="main" class="ui-content" id="result">
        </div>
        <div data-role="footer" data-position="fixed">
            <h1>Szymon Banowski</h1>
        </div>
    </div>
	<div data-role="page" id="matchpage">
        <div data-role="header">
            <a href="#pageone" data-icon="back" style="height: 40%;"></a>
            <h1>Business Card</h1>
        </div>
        <div data-role="main" class="ui-content" id="matchDetails">
        </div>
        <div data-role="footer" data-position="fixed">
            <h1>Szymon Banowski</h1>
        </div>
    </div>
	<div data-role="page" id="standingsPage" data-dialog="true">
			<div data-role="header" data-theme="a">
				<h1>Standings</h1>
			</div>
			<div role="main" class="ui-content" id="standingsResult">
			</div>
		</div>
	<div data-role="page" id="oddsPage" data-dialog="true">
			<div data-role="header" data-theme="a">
				<h1>Odds</h1>
			</div>
			<div role="main" class="ui-content" id="oddsResult">
			</div>
		</div>
</body>
<script>
$("#inter").on('click', function(){
    var urlAPI = 'data.php';
    var date = $('#fdate').val();
    var league = $('#fto').val();
	var link = 'https://apifootball.com/api/?action=get_events&from='+date+'&to='+date+'&league_id='+league+'&match_live=1';
        $.ajax({
	url: urlAPI,
        type: 'POST',
        data: {
            'link': link,
        },
		//zamiana odpowiedzi json na string
        success: function (result) {
			var returnedData = JSON.parse(result);
			var formatedData = JSON.parse(returnedData);
			var html = '';
			console.log(formatedData);
			if(formatedData.error == 404){
			html='This league is not playing on that day';
			$('#result').html(html);
			}
			else{
			$.each(formatedData, function(key, value){
			if(value.match_status == ''){
			html += '<a href="#matchpage">';
			html += '<div data-date='+date+' data-league='+value.league_id+' class="result__item"'+'match_id='+value.match_id+'>';
            html += '<label>'+value.match_time+' '+value.match_hometeam_name+' '+value.match_awayteam_name+'</label>';
            html += '</div>';
			html += '</a>';	
			}
			if(value.match_status == 'FT'){
			html += '<a href="#matchpage">';
			html += '<div data-date='+date+' data-league='+value.league_id+' class="result__item"'+'id='+value.match_id+'>';
            html += '<label>Full Time '+value.match_hometeam_name+' '+value.match_hometeam_score+':'+value.match_awayteam_score+' '+value.match_awayteam_name+'</label>';
            html += '</div>';
			html += '</a>';	
			}	
			if(value.match_status != 'FT' && value.match_status != 'Canc.' && value.match_status !='' && value.match_status != 'Postp.'){
			html += '<a href="#matchpage">';
			html += '<div data-date='+date+' data-league='+value.league_id+' class="result__item"'+'id='+value.match_id+'>';
            html += '<label>'+value.match_status+' '+value.match_hometeam_name+' '+value.match_hometeam_score+':'+value.match_awayteam_score+' '+value.match_awayteam_name+' LIVE!</label>';
            html += '</div>';
			html += '</a>';	
			}
        });
			}
			$('#result').html(html);
        }
    });
});
</script>
<script>
$('body').on('click','.result__item',function(){
var urlAPI = 'data.php';
var elemID = $(this).attr('id');
var elemDate = $(this).attr('data-date');
var elemLeague = $(this).attr('data-league');
var link = 'https://apifootball.com/api/?action=get_events&from='+elemDate+'&to='+elemDate+'&match_id='+elemID+'&match_live=1';
       $.ajax({
		url: urlAPI,
        type: 'POST',
        data: {
            'link': link,
        },
		//zamiana odpowiedzi json na string
        success: function (result) {
			var returnedData = JSON.parse(result);
			var formatedData = JSON.parse(returnedData);
			var html = '';
			html += '<div class="new_result">';
            html += '<label>'+formatedData[0].match_hometeam_name+'-'+formatedData[0].match_awayteam_name+'</label>';
            html += '</div>';
			html += '<a href="#standingsPage" class="standings" id='+elemLeague+'>Standings</a>';
			html += '<a href="#oddsPage" class="bets" data-date='+elemDate+' id='+elemID+'>Odds</a>';
			console.log(formatedData[0].goalscorer);
			//if(formatedData[0].match_status == "FT"){
			//$.each(formatedData[0].goalscorer, function(key, value){
			//html += '<div class="goalscorers">';
            //html += '<label>'+value.time+' '+value.score+' '+value.home_scorer+''+value.away_scorer+'</label>';
            //html += '</div>';
			//});
			//}
			if(formatedData[0].match_status=="FT" ){
			$.each(formatedData[0].goalscorer, function(key, value){
			html += '<div class="goalscorers">';
            html += '<label>'+value.time+' '+value.score+' '+value.home_scorer+''+value.away_scorer+'</label>';
            html += '</div>';
		});
		}
			$('#matchDetails').html(html);
       } 
    });
});
</script>
<script>
$('body').on('click','.standings',function(){
    var urlAPI = 'data.php';
    var elemLeague = $(this).attr('id');
	var link = 'https://apifootball.com/api/?action=get_standings&league_id='+elemLeague;
        $.ajax({
	url: urlAPI,
        type: 'POST',
        data: {
            'link': link,
        },
		//zamiana odpowiedzi json na string
        success: function (result) {
			var returnedData = JSON.parse(result);
			var formatedData = JSON.parse(returnedData);
			formatedData.sort(function(a, b) {
			return parseFloat(a.overall_league_position) - parseFloat(b.overall_league_position);
			});
			var html = '';
			$.each(formatedData, function(key, value){
			html += '<div>';
            html += '<p>'+value.overall_league_position+'.'+value.team_name+'</p>';
            html += '</div>';
        });
			$('#standingsResult').html(html);
        }
    });
});
</script>
<script>
$('body').on('click','.bets',function(){
    var urlAPI = 'data2.php';
	var elemID = $(this).attr('id');
    var elemDate = $(this).attr('data-date');
	var link = 'https://apifootball.com/api/?action=get_odds&from='+elemDate+'&to='+elemDate+'match_id='+elemID;
        $.ajax({
	url: urlAPI,
        type: 'POST',
        data: {
            'link': link,
        },
		//zamiana odpowiedzi json na string
        success: function (result) {
			console.log(result);
			var returnedData = JSON.parse(result);
			var html = '';
			$.each(returnedData, function(key, value){
			html += '<div>';
            html += '<p>'+value.odd_bookmakers+'  '+value.odd_1+'  '+value.odd_x+'  '+value.odd_2+'</p>';
            html += '</div>';
        });
			$('#oddsResult').html(html);
        }
    });
});
</script>
</html>
